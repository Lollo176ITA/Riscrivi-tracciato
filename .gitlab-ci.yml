stages:
  - build

build-windows-exe:
  stage: build
  # Usa un'immagine Windows per PyInstaller
  tags:
    - windows
  image: python:3.11-windowsservercore
  before_script:
    - python -m pip install --upgrade pip
    - pip install pyinstaller
  script:
    - pyinstaller --onefile --name csv-rewriter main.py
  artifacts:
    name: "csv-rewriter-windows-$CI_COMMIT_SHORT_SHA"
    paths:
      - dist/csv-rewriter.exe
    expire_in: 30 days
  only:
    - main
    - master
  when: on_success

